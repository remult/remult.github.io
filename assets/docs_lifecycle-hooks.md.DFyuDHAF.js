import{_ as s,c as a,o as e,a5 as n}from"./chunks/framework.QXCuR9m2.js";const h=JSON.parse('{"title":"Entity Lifecycle Hooks","description":"","frontmatter":{},"headers":[],"relativePath":"docs/lifecycle-hooks.md","filePath":"docs/lifecycle-hooks.md","lastUpdated":1726720596000}'),o={name:"docs/lifecycle-hooks.md"},l=n(`<h1 id="entity-lifecycle-hooks" tabindex="-1">Entity Lifecycle Hooks <a class="header-anchor" href="#entity-lifecycle-hooks" aria-label="Permalink to &quot;Entity Lifecycle Hooks&quot;">​</a></h1><p>In Remult, you can take advantage of Entity Lifecycle Hooks to add custom logic and actions at specific stages of an entity&#39;s lifecycle. There are five lifecycle events available: <code>validation</code>, <code>saving</code>, <code>saved</code>, <code>deleting</code>, and <code>deleted</code>. These hooks allow you to perform actions or validations when specific events occur in the entity&#39;s lifecycle.</p><h2 id="validation" tabindex="-1">Validation <a class="header-anchor" href="#validation" aria-label="Permalink to &quot;Validation&quot;">​</a></h2><ul><li><strong>Runs On</strong>: Backend and Frontend.</li><li><strong>Purpose</strong>: To perform validations on the entity&#39;s data before saving.</li><li><strong>Example</strong>:<div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki dark-plus vp-code" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#DCDCAA;">Entity</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">Task</span><span style="color:#D4D4D4;">&gt;(</span><span style="color:#CE9178;">&quot;tasks&quot;</span><span style="color:#D4D4D4;">, {</span></span>
<span class="line"><span style="color:#DCDCAA;">  validation</span><span style="color:#9CDCFE;">:</span><span style="color:#569CD6;"> async</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">task</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">task</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">title</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">length</span><span style="color:#D4D4D4;"> &lt; </span><span style="color:#B5CEA8;">5</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#C586C0;">      throw</span><span style="color:#569CD6;"> new</span><span style="color:#DCDCAA;"> Error</span><span style="color:#D4D4D4;">(</span><span style="color:#CE9178;">&quot;Task title must be at least 5 characters long.&quot;</span><span style="color:#D4D4D4;">);</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#D4D4D4;">  },</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span></code></pre></div>You can run custom validation like in this example, and you can also use <a href="./validation">builtin validation</a>.</li></ul><h2 id="saving" tabindex="-1">Saving <a class="header-anchor" href="#saving" aria-label="Permalink to &quot;Saving&quot;">​</a></h2><ul><li><strong>Runs On</strong>: Backend (or Frontend if using a local frontend database).</li><li><strong>Purpose</strong>: To execute custom logic before an entity is saved.</li><li><strong>Example</strong>:<div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki dark-plus vp-code" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#DCDCAA;">Entity</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">Task</span><span style="color:#D4D4D4;">&gt;(</span><span style="color:#CE9178;">&quot;tasks&quot;</span><span style="color:#D4D4D4;">, {</span></span>
<span class="line"><span style="color:#DCDCAA;">  saving</span><span style="color:#9CDCFE;">:</span><span style="color:#569CD6;"> async</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">task</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">isNew</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#9CDCFE;">      task</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">createdAt</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Date</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">// Set the creation date for new tasks.</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#9CDCFE;">    task</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">lastUpdated</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Date</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">// Update the last updated date.</span></span>
<span class="line"><span style="color:#D4D4D4;">  },</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span></code></pre></div></li></ul><h2 id="saved" tabindex="-1">Saved <a class="header-anchor" href="#saved" aria-label="Permalink to &quot;Saved&quot;">​</a></h2><ul><li><strong>Runs On</strong>: Backend (or Frontend if using a local frontend database).</li><li><strong>Purpose</strong>: To perform actions after an entity has been successfully saved.</li><li><strong>Example</strong>: Useful for triggering additional processes or updates after saving.</li></ul><h2 id="deleting" tabindex="-1">Deleting <a class="header-anchor" href="#deleting" aria-label="Permalink to &quot;Deleting&quot;">​</a></h2><ul><li><strong>Runs On</strong>: Backend (or Frontend if using a local frontend database).</li><li><strong>Purpose</strong>: To execute custom logic before an entity is deleted.</li><li><strong>Example</strong>: You can use this to ensure related data is properly cleaned up or archived.</li></ul><h2 id="deleted" tabindex="-1">Deleted <a class="header-anchor" href="#deleted" aria-label="Permalink to &quot;Deleted&quot;">​</a></h2><ul><li><strong>Runs On</strong>: Backend (or Frontend if using a local frontend database).</li><li><strong>Purpose</strong>: To perform actions after an entity has been successfully deleted.</li><li><strong>Example</strong>: Similar to the <code>saved</code> event, this is useful for any post-deletion processes.</li></ul><h2 id="field-saving-hook" tabindex="-1">Field Saving Hook <a class="header-anchor" href="#field-saving-hook" aria-label="Permalink to &quot;Field Saving Hook&quot;">​</a></h2><p>Additionally, you can define a field-specific <code>saving</code> hook that allows you to perform custom logic on a specific field before the entity <code>saving</code> hook. It has the following signature:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki dark-plus vp-code" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#9CDCFE;">Fields</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Date</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">Task</span><span style="color:#D4D4D4;">&gt;({</span></span>
<span class="line"><span style="color:#DCDCAA;">  saving</span><span style="color:#9CDCFE;">:</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">task</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">fieldRef</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">isNew</span><span style="color:#D4D4D4;">) </span><span style="color:#9CDCFE;">task</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">createdAt</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Date</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">  },</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span>
<span class="line"><span style="color:#9CDCFE;">createdAt</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Date</span><span style="color:#D4D4D4;">()</span></span></code></pre></div><p>or using the fieldRef</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki dark-plus vp-code" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#9CDCFE;">Fields</span><span style="color:#D4D4D4;">.</span><span style="color:#DCDCAA;">Date</span><span style="color:#D4D4D4;">({</span></span>
<span class="line"><span style="color:#DCDCAA;">  saving</span><span style="color:#9CDCFE;">:</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">_</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">fieldRef</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">isNew</span><span style="color:#D4D4D4;">) </span><span style="color:#9CDCFE;">fieldRef</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">value</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Date</span><span style="color:#D4D4D4;">()</span></span>
<span class="line"><span style="color:#D4D4D4;">  },</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span>
<span class="line"><span style="color:#9CDCFE;">createdAt</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Date</span><span style="color:#D4D4D4;">()</span></span></code></pre></div><p>You can use the field <code>saving</code> hook to perform specialized actions on individual fields during the entity&#39;s saving process.</p><h2 id="lifecycle-event-args" tabindex="-1">Lifecycle Event Args <a class="header-anchor" href="#lifecycle-event-args" aria-label="Permalink to &quot;Lifecycle Event Args&quot;">​</a></h2><p>Each lifecycle event receives an instance of the relevant entity and an event args of type <code>LifecycleEvent</code>. The <code>LifecycleEvent</code> object provides various fields and methods to interact with the entity and its context. Here are the fields available in the <code>LifecycleEvent</code>:</p><ul><li><code>isNew</code>: A boolean indicating whether the entity is new (being created).</li><li><code>fields</code>: A reference to the entity&#39;s fields, allowing you to access and modify field values.</li><li><code>id</code>: The ID of the entity.</li><li><code>originalId</code>: The original ID of the entity, which may differ during certain operations.</li><li><code>repository</code>: The repository associated with the entity.</li><li><code>metadata</code>: The metadata of the entity, providing information about its structure.</li><li><code>preventDefault()</code>: A method to prevent the default behavior associated with the event.</li><li><code>relations</code>: Access to repository relations for the entity, allowing you to work with related data.</li></ul><h2 id="example-usage" tabindex="-1">Example Usage <a class="header-anchor" href="#example-usage" aria-label="Permalink to &quot;Example Usage&quot;">​</a></h2><p>Here&#39;s an example of how to use Entity Lifecycle Hooks to add custom logic to the <code>saving</code> event:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki dark-plus vp-code" tabindex="0"><code><span class="line"><span style="color:#D4D4D4;">@</span><span style="color:#DCDCAA;">Entity</span><span style="color:#D4D4D4;">&lt;</span><span style="color:#4EC9B0;">Task</span><span style="color:#D4D4D4;">&gt;(</span><span style="color:#CE9178;">&quot;tasks&quot;</span><span style="color:#D4D4D4;">, {</span></span>
<span class="line"><span style="color:#DCDCAA;">  saving</span><span style="color:#9CDCFE;">:</span><span style="color:#569CD6;"> async</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">task</span><span style="color:#D4D4D4;">, </span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">) </span><span style="color:#569CD6;">=&gt;</span><span style="color:#D4D4D4;"> {</span></span>
<span class="line"><span style="color:#C586C0;">    if</span><span style="color:#D4D4D4;"> (</span><span style="color:#9CDCFE;">e</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">isNew</span><span style="color:#D4D4D4;">) {</span></span>
<span class="line"><span style="color:#9CDCFE;">      task</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">createdAt</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Date</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">// Set the creation date for new tasks.</span></span>
<span class="line"><span style="color:#D4D4D4;">    }</span></span>
<span class="line"><span style="color:#9CDCFE;">    task</span><span style="color:#D4D4D4;">.</span><span style="color:#9CDCFE;">lastUpdated</span><span style="color:#D4D4D4;"> = </span><span style="color:#569CD6;">new</span><span style="color:#DCDCAA;"> Date</span><span style="color:#D4D4D4;">(); </span><span style="color:#6A9955;">// Update the last updated date.</span></span>
<span class="line"><span style="color:#D4D4D4;">  },</span></span>
<span class="line"><span style="color:#D4D4D4;">})</span></span></code></pre></div><p>In this example, we&#39;ve defined a <code>saving</code> event for the <code>Task</code> entity. When a task is being saved, the event handler is called. If the task is new (not yet saved), we set its <code>createdAt</code> field to the current date. In either case, we update the <code>lastUpdated</code> field with the current date.</p><p>Entity Lifecycle Hooks provide a powerful way to customize the behavior of your entities and ensure that specific actions or validations are performed at the right time in the entity&#39;s lifecycle. You can use these hooks to streamline your application&#39;s data management and enforce business rules.</p>`,26),t=[l];function p(c,r,i,D,d,y){return e(),a("div",null,t)}const u=s(o,[["render",p]]);export{h as __pageData,u as default};
