import{_ as i,c as a,o as t,L as l}from"./chunks/framework.DdPzwmCl.js";const g=JSON.parse('{"title":"Database","description":"","frontmatter":{},"headers":[],"relativePath":"tutorials/sveltekit/database.md","filePath":"tutorials/sveltekit/database.md","lastUpdated":1739107195000}'),n={name:"tutorials/sveltekit/database.md"};function e(h,s,k,p,r,d){return t(),a("div",null,s[0]||(s[0]=[l(`<h1 id="database" tabindex="-1">Database <a class="header-anchor" href="#database" aria-label="Permalink to &quot;Database&quot;">â€‹</a></h1><p>Up until now the todo app has been using a plain JSON file to store the list of tasks. In production, you will often want to use a proper database. Remult supports a (long) list of relational and non-relational databases. In this tutorial, let&#39;s use <code>Postgres</code>.</p><div class="tip custom-block"><p class="custom-block-title">Learn more</p><p>See the <a href="https://remult.dev/docs/quickstart.html#connecting-a-database" target="_blank" rel="noreferrer">Quickstart</a> article to find out more.</p></div><div class="warning custom-block"><p class="custom-block-title">Don&#39;t have Postgres installed? Don&#39;t have to.</p><p>Don&#39;t worry if you don&#39;t have Postgres installed locally. In the next step of the tutorial, we&#39;ll configure the app to use Postgres in production, and keep using JSON files in our dev environment.</p><p><strong>Simply install <code>postgres-node</code> per step 1 below and move on to the <a href="./deployment">Deployment section of the tutorial</a>.</strong></p></div><ol><li><p>Install <code>postgres-node</code> (&quot;pg&quot;).</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#C0CAF5;--shiki-light:#6F42C1;">npm</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;"> i</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;"> pg</span></span></code></pre></div></li><li><p>Add an environment variables called DATABASE_URL and set it with your connection string:</p></li></ol><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-x_Xx0" id="tab-yH6Wl_3" checked><label data-title=".env.local" for="tab-yH6Wl_3">.env.local</label></div><div class="blocks"><div class="language-sh vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">DATABASE_URL</span><span style="--shiki-dark:#89DDFF;--shiki-light:#D73A49;">=</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">postgresql://username:password@host:port/dbname[?paramspec</span><span style="--shiki-dark:#A9B1D6;--shiki-light:#24292E;">]</span></span></code></pre></div></div></div><ol start="3"><li>Add a <code>dataProvider</code> to Remult&#39;s handler.</li></ol><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-MZyj6" id="tab-4AQF7xg" checked><label data-title="src/server/api.ts" for="tab-4AQF7xg">src/server/api.ts</label></div><div class="blocks"><div class="language-ts vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes tokyo-night github-light has-diff vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> { </span><span style="--shiki-dark:#0DB9D7;--shiki-light:#24292E;">remultSveltekit</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> }</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;"> from</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">remult/remult-sveltekit</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span></span>
<span class="line"><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> { </span><span style="--shiki-dark:#0DB9D7;--shiki-light:#24292E;">Task</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> }</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;"> from</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">./shared/Task</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span></span>
<span class="line"><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> { </span><span style="--shiki-dark:#0DB9D7;--shiki-light:#24292E;">TasksController</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> }</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;"> from</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">./shared/TasksController</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span></span>
<span class="line diff add"><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> { </span><span style="--shiki-dark:#0DB9D7;--shiki-light:#24292E;">createPostgresDataProvider</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> }</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;"> from</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">remult/postgres</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span></span>
<span class="line diff add"><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;">import</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> { </span><span style="--shiki-dark:#0DB9D7;--shiki-light:#24292E;">DATABASE_URL</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> }</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;"> from</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">$env/static/private</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#9D7CD8;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;"> const</span><span style="--shiki-dark:#BB9AF7;--shiki-light:#005CC5;"> api</span><span style="--shiki-dark:#89DDFF;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;"> remultSveltekit</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">({</span></span>
<span class="line"><span style="--shiki-dark:#73DACA;--shiki-light:#24292E;">  entities</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> [</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#24292E;">Task</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">]</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#73DACA;--shiki-light:#24292E;">  controllers</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> [</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#24292E;">TasksController</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">]</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">,</span></span>
<span class="line diff add"><span style="--shiki-dark:#73DACA;--shiki-light:#24292E;">  dataProvider</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#FF9E64;--shiki-light:#005CC5;"> DATABASE_URL</span></span>
<span class="line diff add"><span style="--shiki-dark:#BB9AF7;--shiki-light:#D73A49;">    ?</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;"> createPostgresDataProvider</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">({</span><span style="--shiki-dark:#73DACA;--shiki-light:#24292E;"> connectionString</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#FF9E64;--shiki-light:#005CC5;"> DATABASE_URL</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> })</span></span>
<span class="line diff add"><span style="--shiki-dark:#BB9AF7;--shiki-light:#D73A49;">    :</span><span style="--shiki-dark:#FF9E64;--shiki-light:#005CC5;"> undefined</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">  getUser</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#9D7CD8;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;"> async</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#E0AF68;--shiki-light:#E36209;">event</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">)</span><span style="--shiki-dark:#BB9AF7;--shiki-light:#D73A49;"> =&gt;</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#9D7CD8;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;">    const</span><span style="--shiki-dark:#BB9AF7;--shiki-light:#005CC5;"> auth</span><span style="--shiki-dark:#89DDFF;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#BB9AF7;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;"> await</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;"> event</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">?.</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#24292E;">locals</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">?.</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">auth</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#BB9AF7;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;">    return</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;"> auth</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">?.</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#24292E;">user</span><span style="--shiki-dark:#89DDFF;--shiki-light:#D73A49;"> as</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#6F42C1;"> UserInfo</span></span>
<span class="line"><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">  }</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">})</span></span></code></pre></div></div></div><p>Once the application restarts, it&#39;ll try to use postgres as the data source for your application.</p><p>If <code>DATABASE_URL</code> is found, it&#39;ll automatically create the <code>tasks</code> table for you.</p><p>If <code>DATABASE_URL</code> is not has found, it&#39;ll just fallback to our local JSON files.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can also disable this automatic migration behavior. It&#39;s not part of this tutorial so if you want to learn more, follow this <a href="/docs/migrations">link</a>.</p></div>`,12)]))}const F=i(n,[["render",e]]);export{g as __pageData,F as default};
