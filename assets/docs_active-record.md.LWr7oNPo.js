import{_ as s,c as t,o as a,L as e}from"./chunks/framework.DdPzwmCl.js";const c=JSON.parse('{"title":"Mutability and the Active Record Pattern","description":"","frontmatter":{},"headers":[],"relativePath":"docs/active-record.md","filePath":"docs/active-record.md","lastUpdated":1714395765000}'),n={name:"docs/active-record.md"};function h(l,i,p,r,k,o){return a(),t("div",null,i[0]||(i[0]=[e(`<h1 id="mutability-and-the-active-record-pattern" tabindex="-1">Mutability and the Active Record Pattern <a class="header-anchor" href="#mutability-and-the-active-record-pattern" aria-label="Permalink to &quot;Mutability and the Active Record Pattern&quot;">​</a></h1><p>The Active Record pattern is a concept in software architecture, particularly useful when working with mutable objects whose state may change over time. This design pattern facilitates direct interaction with the database through the object representing a row of the data table. In this article, we&#39;ll delve into the fundamentals of the Active Record pattern, contrasting it with immutable patterns, and exploring its implementation and advantages in software development.</p><h3 id="immutable-vs-mutable-patterns" tabindex="-1">Immutable vs. Mutable Patterns <a class="header-anchor" href="#immutable-vs-mutable-patterns" aria-label="Permalink to &quot;Immutable vs. Mutable Patterns&quot;">​</a></h3><p>In modern software development, handling data objects can generally be approached in two ways: immutable and mutable patterns.</p><p><strong>Immutable objects</strong> do not change once they are created. Any modification on an immutable object results in a new object. For example, in the React framework, immutability is often preferred:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#51597D;--shiki-dark-font-style:italic;--shiki-light:#6A737D;--shiki-light-font-style:inherit;">// Immutable update</span></span>
<span class="line"><span style="--shiki-dark:#9D7CD8;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;">const</span><span style="--shiki-dark:#BB9AF7;--shiki-light:#005CC5;"> updatePerson</span><span style="--shiki-dark:#89DDFF;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> {</span><span style="--shiki-dark:#F7768E;--shiki-dark-font-weight:bold;--shiki-light:#D73A49;--shiki-light-font-weight:inherit;"> ...</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#73DACA;--shiki-light:#24292E;"> name</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">newName</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> }</span></span></code></pre></div><p>However, libraries like MobX offer the flexibility to work with mutable objects while still providing the reactivity that React components need.</p><p><strong>Mutable objects</strong>, on the other hand, allow for changes directly on the object itself:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#51597D;--shiki-dark-font-style:italic;--shiki-light:#6A737D;--shiki-light-font-style:inherit;">// Mutable update</span></span>
<span class="line"><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#24292E;">name</span><span style="--shiki-dark:#89DDFF;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">newName</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span></span></code></pre></div><p>Mutable patterns are especially prevalent in scenarios where the state of objects changes frequently, making them a staple in many programming environments outside of React.</p><h3 id="the-role-of-active-record-pattern" tabindex="-1">The Role of Active Record Pattern <a class="header-anchor" href="#the-role-of-active-record-pattern" aria-label="Permalink to &quot;The Role of Active Record Pattern&quot;">​</a></h3><p>The Active Record pattern embodies the concept of mutability by binding business logic to object data models. Typically, each model instance corresponds to a row in the database, with the class methods providing the functionality to create, read, update, and delete records.</p><h3 id="warning-mutable-objects-in-react" tabindex="-1">Warning: Mutable Objects in React <a class="header-anchor" href="#warning-mutable-objects-in-react" aria-label="Permalink to &quot;Warning: Mutable Objects in React&quot;">​</a></h3><p>Using mutable objects with the Active Record pattern in React (without libraries like MobX) requires careful handling. React’s rendering cycle is built around the premise of immutability; it typically relies on immutable state management to trigger re-renders. When mutable objects change state outside the scope of React&#39;s <code>useState</code> or <code>useReducer</code>, React does not automatically know to re-render the affected components. This can lead to issues where the UI does not reflect the current application state.</p><p>These challenges can be mitigated by integrating state management tools that are designed to work well with mutable objects, such as MobX. MobX provides mechanisms to track changes in data and automatically re-render components when mutations occur. This aligns more naturally with the Active Record pattern within the context of React, ensuring that the UI stays in sync with the underlying data.</p><h4 id="using-entitybase-and-identity" tabindex="-1">Using EntityBase and IdEntity <a class="header-anchor" href="#using-entitybase-and-identity" aria-label="Permalink to &quot;Using EntityBase and IdEntity&quot;">​</a></h4><p>In practice, leveraging the Active Record pattern often involves inheriting from classes such as <code>EntityBase</code> or <code>IdEntity</code> (a variant of <code>EntityBase</code> with a UUID as the identifier). These base classes enrich models with methods that simplify manipulations of their attributes and their persistence in the database.</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">@</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">Entity</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">people</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#7DCFFF;--shiki-light:#D73A49;">export</span><span style="--shiki-dark:#BB9AF7;--shiki-light:#D73A49;"> class</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#6F42C1;"> Person</span><span style="--shiki-dark:#9D7CD8;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;"> extends</span><span style="--shiki-dark:#BB9AF7;--shiki-light:#6F42C1;"> IdEntity</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">  @</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">Fields</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">string</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">()</span></span>
<span class="line"><span style="--shiki-dark:#73DACA;--shiki-light:#E36209;">  name</span><span style="--shiki-dark:#89DDFF;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;&#39;</span></span>
<span class="line"><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">}</span></span></code></pre></div><p><strong>Explanation:</strong> The <code>Person</code> class represents individuals in the &#39;people&#39; table and inherits from <code>IdEntity</code>. This inheritance means that there is no need to explicitly define an <code>id</code> field for this class, as <code>IdEntity</code> automatically includes a UUID field (<code>id</code>). Consequently, <code>Person</code> benefits from all the functionalities of <code>EntityBase</code>, which include tracking changes and handling CRUD operations, while also automatically gaining a UUID as the identifier.</p><h3 id="mutable-vs-entitybase-active-record" tabindex="-1">Mutable vs EntityBase (active-record) <a class="header-anchor" href="#mutable-vs-entitybase-active-record" aria-label="Permalink to &quot;Mutable vs EntityBase (active-record)&quot;">​</a></h3><p><strong>Traditional approach without Active Record:</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#51597D;--shiki-dark-font-style:italic;--shiki-light:#6A737D;--shiki-light-font-style:inherit;">// Updating a person&#39;s name the traditional way</span></span>
<span class="line"><span style="--shiki-dark:#BB9AF7;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;">await</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;"> repo</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">Person</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">)</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">update</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">,</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> {</span><span style="--shiki-dark:#73DACA;--shiki-light:#24292E;"> name</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">:</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">newName</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> })</span></span></code></pre></div><p><strong>Using Active Record with EntityBase:</strong></p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#51597D;--shiki-dark-font-style:italic;--shiki-light:#6A737D;--shiki-light-font-style:inherit;">// Active Record style</span></span>
<span class="line"><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#24292E;">name</span><span style="--shiki-dark:#89DDFF;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;"> &#39;</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">newName</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">&#39;</span></span>
<span class="line"><span style="--shiki-dark:#BB9AF7;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;">await</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;"> person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">save</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">()</span></span></code></pre></div><p>This pattern also simplifies other operations:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#51597D;--shiki-dark-font-style:italic;--shiki-light:#6A737D;--shiki-light-font-style:inherit;">// Deleting a record</span></span>
<span class="line"><span style="--shiki-dark:#BB9AF7;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;">await</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;"> person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">delete</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#51597D;--shiki-dark-font-style:italic;--shiki-light:#6A737D;--shiki-light-font-style:inherit;">// Checking if the record is new</span></span>
<span class="line"><span style="--shiki-dark:#BB9AF7;--shiki-light:#D73A49;">if</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> (</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">isNew</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">())</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-dark:#51597D;--shiki-dark-font-style:italic;--shiki-light:#6A737D;--shiki-light-font-style:inherit;">  // Perform a specific action</span></span>
<span class="line"><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">}</span></span></code></pre></div><h4 id="helper-members-in-entitybase" tabindex="-1">Helper Members in EntityBase <a class="header-anchor" href="#helper-members-in-entitybase" aria-label="Permalink to &quot;Helper Members in EntityBase&quot;">​</a></h4><p>EntityBase provides additional utility members like <code>_</code> and <code>$</code> to facilitate more complex interactions:</p><ul><li><strong><code>_</code> (EntityRef Object):</strong> Allows performing operations on a specific instance of an entity.</li></ul><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#BB9AF7;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;">await</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;"> person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#24292E;">_</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">reload</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">()</span></span></code></pre></div><ul><li><strong><code>$</code> (FieldsRef):</strong> Provides access to detailed information about each field in the current instance, such as their original and current values:</li></ul><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#51597D;--shiki-dark-font-style:italic;--shiki-light:#6A737D;--shiki-light-font-style:inherit;">// Logging changes in a field</span></span>
<span class="line"><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">console</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">log</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">(</span></span>
<span class="line"><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">  \`</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">Name changed from &quot;</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#032F62;">\${</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">$</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">name</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#24292E;">originalValue</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#032F62;">}</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">&quot; to &quot;</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#032F62;">\${</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">person</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">.</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#24292E;">name</span><span style="--shiki-dark:#7DCFFF;--shiki-light:#032F62;">}</span><span style="--shiki-dark:#9ECE6A;--shiki-light:#032F62;">&quot;</span><span style="--shiki-dark:#89DDFF;--shiki-light:#032F62;">\`</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">,</span></span>
<span class="line"><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">)</span></span></code></pre></div><h3 id="alternative-implementations" tabindex="-1">Alternative Implementations <a class="header-anchor" href="#alternative-implementations" aria-label="Permalink to &quot;Alternative Implementations&quot;">​</a></h3><p>Even without direct inheritance from <code>EntityBase</code>, similar functionalities can be achieved using helper functions such as <code>getEntityRef</code>, which encapsulates an entity instance for manipulation and persistence:</p><div class="language-typescript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes tokyo-night github-light vp-code" style="--shiki-dark:#a9b1d6;--shiki-light:#24292e;--shiki-dark-bg:#1a1b26;--shiki-light-bg:#fff;" tabindex="0"><code><span class="line"><span style="--shiki-dark:#9D7CD8;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;">const</span><span style="--shiki-dark:#BB9AF7;--shiki-light:#005CC5;"> ref</span><span style="--shiki-dark:#89DDFF;--shiki-light:#D73A49;"> =</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;"> getEntityRef</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">(</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;">person</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">)</span></span>
<span class="line"><span style="--shiki-dark:#BB9AF7;--shiki-dark-font-style:italic;--shiki-light:#D73A49;--shiki-light-font-style:inherit;">await</span><span style="--shiki-dark:#C0CAF5;--shiki-light:#24292E;"> ref</span><span style="--shiki-dark:#89DDFF;--shiki-light:#24292E;">.</span><span style="--shiki-dark:#7AA2F7;--shiki-light:#6F42C1;">save</span><span style="--shiki-dark:#9ABDF5;--shiki-light:#24292E;">()</span></span></code></pre></div><h3 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to &quot;Conclusion&quot;">​</a></h3><p>The Active Record pattern offers a straightforward and intuitive approach to interacting with database records through object-oriented models. It is particularly beneficial in environments where business logic needs to be tightly coupled with data manipulation, providing a clear and efficient way to handle data state changes. However, integrating the Active Record pattern with mutable objects in React can be challenging.</p>`,37)]))}const g=s(n,[["render",h]]);export{c as __pageData,g as default};
