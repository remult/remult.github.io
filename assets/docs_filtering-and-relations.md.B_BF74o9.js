import{_ as n,c as a,o as l,L as o}from"./chunks/framework.BLY-PH98.js";const i=JSON.parse('{"title":"Filtering and Relations","description":"","frontmatter":{},"headers":[],"relativePath":"docs/filtering-and-relations.md","filePath":"docs/filtering-and-relations.md","lastUpdated":1729890666000}'),p={name:"docs/filtering-and-relations.md"};function e(t,s,c,r,F,y){return l(),a("div",null,s[0]||(s[0]=[o(`<h1 id="filtering-and-relations" tabindex="-1">Filtering and Relations <a class="header-anchor" href="#filtering-and-relations" aria-label="Permalink to &quot;Filtering and Relations&quot;">â€‹</a></h1><div class="tip custom-block"><p class="custom-block-title"><strong>Interactive Learning Available! ðŸš€</strong></p><p>Looking to get hands-on with this topic? Try out our new <a href="https://learn.remult.dev/in-depth/4-filtering/1-custom-filters" target="_blank" rel="noreferrer"><strong>interactive tutorial</strong></a> on Filtering relations, where you can explore and practice directly in the browser. This guided experience offers step-by-step lessons to help you master filtering in Remult with practical examples and exercises.</p><p><a href="https://learn.remult.dev/in-depth/4-filtering/1-custom-filters" target="_blank" rel="noreferrer">Click here to dive into the interactive tutorial on Filtering and Relations!</a></p></div><p>In this article, we&#39;ll discuss several relevant techniques for one-to-many relations. Consider the following scenario where we have a customer entity and an Orders entity.</p><p>We&#39;ll use the following entities and data for this article.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#7DCFFF;">import</span><span style="color:#9ABDF5;"> { </span><span style="color:#0DB9D7;">Entity</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> Field</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> Fields</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> remult</span><span style="color:#89DDFF;">,</span><span style="color:#0DB9D7;"> Relations</span><span style="color:#9ABDF5;"> }</span><span style="color:#7DCFFF;"> from</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">remult</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#7AA2F7;">Entity</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">customers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#7DCFFF;">export</span><span style="color:#BB9AF7;"> class</span><span style="color:#C0CAF5;"> Customer</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">  @</span><span style="color:#C0CAF5;">Fields</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">autoIncrement</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#73DACA;">  id</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> 0</span></span>
<span class="line"><span style="color:#89DDFF;">  @</span><span style="color:#C0CAF5;">Fields</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">string</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#73DACA;">  name</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">  @</span><span style="color:#C0CAF5;">Fields</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">string</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#73DACA;">  city</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">  @</span><span style="color:#C0CAF5;">Relations</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">toMany</span><span style="color:#9ABDF5;">(()</span><span style="color:#BB9AF7;"> =&gt;</span><span style="color:#C0CAF5;"> Order</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#73DACA;">  orders</span><span style="color:#89DDFF;">?:</span><span style="color:#C0CAF5;"> Order</span><span style="color:#9ABDF5;">[]</span></span>
<span class="line"><span style="color:#9ABDF5;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#7AA2F7;">Entity</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">orders</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#7DCFFF;">export</span><span style="color:#BB9AF7;"> class</span><span style="color:#C0CAF5;"> Order</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">  @</span><span style="color:#C0CAF5;">Fields</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">autoIncrement</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#73DACA;">  id</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> 0</span></span>
<span class="line"><span style="color:#89DDFF;">  @</span><span style="color:#C0CAF5;">Relations</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">toOne</span><span style="color:#9ABDF5;">(()</span><span style="color:#BB9AF7;"> =&gt;</span><span style="color:#C0CAF5;"> Customer</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#73DACA;">  customer</span><span style="color:#89DDFF;">!:</span><span style="color:#C0CAF5;"> Customer</span></span>
<span class="line"><span style="color:#89DDFF;">  @</span><span style="color:#C0CAF5;">Fields</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">number</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"><span style="color:#73DACA;">  amount</span><span style="color:#89DDFF;"> =</span><span style="color:#FF9E64;"> 0</span></span>
<span class="line"><span style="color:#9ABDF5;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Use Case in this article</p><p>Let&#39;s say that we want to filter all the orders of customers who are in London.</p><p>Let&#39;s have a look at the different options to achieve this.</p></div><h2 id="option-1-use-in-statement" tabindex="-1">Option 1 - Use In Statement <a class="header-anchor" href="#option-1-use-in-statement" aria-label="Permalink to &quot;Option 1 - Use In Statement&quot;">â€‹</a></h2><p>Add the <code>where</code> inline to the <code>find</code> method.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#C0CAF5;">console</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">table</span><span style="color:#9ABDF5;">(</span></span>
<span class="line"><span style="color:#BB9AF7;font-style:italic;">  await</span><span style="color:#7AA2F7;"> repo</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Order</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">find</span><span style="color:#9ABDF5;">({</span></span>
<span class="line"><span style="color:#73DACA;">    where</span><span style="color:#89DDFF;">:</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#73DACA;">      customer</span><span style="color:#89DDFF;">:</span><span style="color:#BB9AF7;font-style:italic;"> await</span><span style="color:#7AA2F7;"> repo</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Customer</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">find</span><span style="color:#9ABDF5;">({</span></span>
<span class="line"><span style="color:#41A6B5;">        where</span><span style="color:#89DDFF;">:</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#41A6B5;">          city</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">London</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">        }</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">      })</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">    }</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">  })</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">)</span></span></code></pre></div><h2 id="option-2-use-custom-filter" tabindex="-1">Option 2 - Use Custom Filter <a class="header-anchor" href="#option-2-use-custom-filter" aria-label="Permalink to &quot;Option 2 - Use Custom Filter&quot;">â€‹</a></h2><p>We can refactor this to a custom filter that will be easier to use and will run on the backend</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#7DCFFF;">import</span><span style="color:#9ABDF5;"> { </span><span style="color:#0DB9D7;">Filter</span><span style="color:#9ABDF5;"> }</span><span style="color:#7DCFFF;"> from</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">remult</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#7AA2F7;">Entity</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">orders</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#9ABDF5;"> {</span><span style="color:#73DACA;"> allowApiCrud</span><span style="color:#89DDFF;">:</span><span style="color:#FF9E64;"> true</span><span style="color:#9ABDF5;"> })</span></span>
<span class="line"><span style="color:#7DCFFF;">export</span><span style="color:#BB9AF7;"> class</span><span style="color:#C0CAF5;"> Order</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#51597D;font-style:italic;">  //...</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">  static</span><span style="color:#73DACA;"> filterCity</span><span style="color:#89DDFF;"> =</span><span style="color:#C0CAF5;"> Filter</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">createCustom</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C0CAF5;">Order</span><span style="color:#89DDFF;">,</span><span style="color:#9ABDF5;"> {</span><span style="color:#73DACA;"> city</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;"> string</span><span style="color:#9ABDF5;"> }</span><span style="color:#89DDFF;">&gt;</span><span style="color:#9ABDF5;">(</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">    async</span><span style="color:#9ABDF5;"> (</span><span style="color:#89DDFF;">{</span><span style="color:#E0AF68;"> city</span><span style="color:#89DDFF;"> }</span><span style="color:#9ABDF5;">)</span><span style="color:#BB9AF7;"> =&gt;</span><span style="color:#9ABDF5;"> ({</span></span>
<span class="line"><span style="color:#73DACA;">      customer</span><span style="color:#89DDFF;">:</span><span style="color:#BB9AF7;font-style:italic;"> await</span><span style="color:#7AA2F7;"> repo</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Customer</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">find</span><span style="color:#9ABDF5;">({</span><span style="color:#73DACA;"> where</span><span style="color:#89DDFF;">:</span><span style="color:#9ABDF5;"> {</span><span style="color:#C0CAF5;"> city</span><span style="color:#9ABDF5;"> }</span><span style="color:#9ABDF5;"> })</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">    })</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">  )</span></span>
<span class="line"><span style="color:#9ABDF5;">}</span></span></code></pre></div><p>And then we can use it:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#C0CAF5;">console</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">table</span><span style="color:#9ABDF5;">(</span></span>
<span class="line"><span style="color:#BB9AF7;font-style:italic;">  await</span><span style="color:#7AA2F7;"> repo</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Order</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">find</span><span style="color:#9ABDF5;">({</span></span>
<span class="line"><span style="color:#73DACA;">    where</span><span style="color:#89DDFF;">:</span><span style="color:#C0CAF5;"> Order</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">filterCity</span><span style="color:#9ABDF5;">({</span></span>
<span class="line"><span style="color:#73DACA;">      city</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">London</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">    })</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">  })</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">)</span></span></code></pre></div><h2 id="option-3-custom-filter-sql" tabindex="-1">Option 3 - Custom Filter (SQL) <a class="header-anchor" href="#option-3-custom-filter-sql" aria-label="Permalink to &quot;Option 3 - Custom Filter (SQL)&quot;">â€‹</a></h2><p>We can improve on the custom filter by using the database&#39;s in statement capabilities:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#7DCFFF;">import</span><span style="color:#9ABDF5;"> { </span><span style="color:#0DB9D7;">SqlDatabase</span><span style="color:#9ABDF5;"> }</span><span style="color:#7DCFFF;"> from</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">remult</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#7AA2F7;">Entity</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">orders</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#9ABDF5;"> {</span><span style="color:#73DACA;"> allowApiCrud</span><span style="color:#89DDFF;">:</span><span style="color:#FF9E64;"> true</span><span style="color:#9ABDF5;"> })</span></span>
<span class="line"><span style="color:#7DCFFF;">export</span><span style="color:#BB9AF7;"> class</span><span style="color:#C0CAF5;"> Order</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#51597D;font-style:italic;">  //...</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">  static</span><span style="color:#73DACA;"> filterCity</span><span style="color:#89DDFF;"> =</span><span style="color:#C0CAF5;"> Filter</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">createCustom</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C0CAF5;">Order</span><span style="color:#89DDFF;">,</span><span style="color:#9ABDF5;"> {</span><span style="color:#73DACA;"> city</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;"> string</span><span style="color:#9ABDF5;"> }</span><span style="color:#89DDFF;">&gt;</span><span style="color:#9ABDF5;">(</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">    async</span><span style="color:#9ABDF5;"> (</span><span style="color:#89DDFF;">{</span><span style="color:#E0AF68;"> city</span><span style="color:#89DDFF;"> }</span><span style="color:#9ABDF5;">)</span><span style="color:#BB9AF7;"> =&gt;</span></span>
<span class="line"><span style="color:#C0CAF5;">      SqlDatabase</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">rawFilter</span><span style="color:#9ABDF5;">(</span></span>
<span class="line"><span style="color:#9ABDF5;">        (</span><span style="color:#89DDFF;">{</span><span style="color:#E0AF68;"> param</span><span style="color:#89DDFF;"> }</span><span style="color:#9ABDF5;">)</span><span style="color:#BB9AF7;"> =&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">          \`</span><span style="color:#9ECE6A;">customer in (select id from customers where city = </span><span style="color:#7DCFFF;">\${</span><span style="color:#7AA2F7;">param</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">city</span><span style="color:#9ABDF5;">)</span><span style="color:#7DCFFF;">}</span><span style="color:#9ECE6A;">)</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">      )</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">  )</span></span>
<span class="line"><span style="color:#9ABDF5;">}</span></span></code></pre></div><p>We can also reuse the entity definitions by using <code>dbNamesOf</code> and <code>filterToRaw</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#7DCFFF;">import</span><span style="color:#9ABDF5;"> { </span><span style="color:#0DB9D7;">dbNamesOf</span><span style="color:#9ABDF5;"> }</span><span style="color:#7DCFFF;"> from</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">remult</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#7AA2F7;">Entity</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">orders</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#9ABDF5;"> {</span><span style="color:#73DACA;"> allowApiCrud</span><span style="color:#89DDFF;">:</span><span style="color:#FF9E64;"> true</span><span style="color:#9ABDF5;"> })</span></span>
<span class="line"><span style="color:#7DCFFF;">export</span><span style="color:#BB9AF7;"> class</span><span style="color:#C0CAF5;"> Order</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#51597D;font-style:italic;">  //...</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">  static</span><span style="color:#73DACA;"> filterCity</span><span style="color:#89DDFF;"> =</span><span style="color:#C0CAF5;"> Filter</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">createCustom</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C0CAF5;">Order</span><span style="color:#89DDFF;">,</span><span style="color:#9ABDF5;"> {</span><span style="color:#73DACA;"> city</span><span style="color:#89DDFF;">:</span><span style="color:#0DB9D7;"> string</span><span style="color:#9ABDF5;"> }</span><span style="color:#89DDFF;">&gt;</span><span style="color:#9ABDF5;">(</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">    async</span><span style="color:#9ABDF5;"> (</span><span style="color:#89DDFF;">{</span><span style="color:#E0AF68;"> city</span><span style="color:#89DDFF;"> }</span><span style="color:#9ABDF5;">)</span><span style="color:#BB9AF7;"> =&gt;</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">      const</span><span style="color:#BB9AF7;"> orders</span><span style="color:#89DDFF;"> =</span><span style="color:#BB9AF7;font-style:italic;"> await</span><span style="color:#7AA2F7;"> dbNamesOf</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Order</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">      const</span><span style="color:#BB9AF7;"> customers</span><span style="color:#89DDFF;"> =</span><span style="color:#BB9AF7;font-style:italic;"> await</span><span style="color:#7AA2F7;"> dbNamesOf</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Customer</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#BB9AF7;font-style:italic;">      return</span><span style="color:#C0CAF5;"> SqlDatabase</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">rawFilter</span><span style="color:#9ABDF5;">(</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">        async</span><span style="color:#9ABDF5;"> (</span><span style="color:#89DDFF;">{</span><span style="color:#E0AF68;"> filterToRaw</span><span style="color:#89DDFF;"> }</span><span style="color:#9ABDF5;">) </span><span style="color:#BB9AF7;">=&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">          \`</span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">orders</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">customer</span><span style="color:#7DCFFF;">}</span><span style="color:#9ECE6A;"> in </span></span>
<span class="line"><span style="color:#9ECE6A;">               (select </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">customers</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">id</span><span style="color:#7DCFFF;">}</span><span style="color:#9ECE6A;"> </span></span>
<span class="line"><span style="color:#9ECE6A;">                  from </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">customers</span><span style="color:#7DCFFF;">}</span><span style="color:#9ECE6A;"> </span></span>
<span class="line"><span style="color:#9ECE6A;">                 where </span><span style="color:#7DCFFF;">\${</span><span style="color:#BB9AF7;font-style:italic;">await</span><span style="color:#7AA2F7;"> filterToRaw</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Customer</span><span style="color:#89DDFF;">,</span><span style="color:#9ABDF5;"> {</span><span style="color:#C0CAF5;"> city</span><span style="color:#9ABDF5;"> })</span><span style="color:#7DCFFF;">}</span><span style="color:#9ECE6A;">)</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">      )</span></span>
<span class="line"><span style="color:#9ABDF5;">    }</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">  )</span></span>
<span class="line"><span style="color:#9ABDF5;">}</span></span></code></pre></div><h2 id="option-4-sqlexpression-field" tabindex="-1">Option 4 - sqlExpression field <a class="header-anchor" href="#option-4-sqlexpression-field" aria-label="Permalink to &quot;Option 4 - sqlExpression field&quot;">â€‹</a></h2><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#7AA2F7;">Entity</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">orders</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#9ABDF5;"> {</span><span style="color:#73DACA;"> allowApiCrud</span><span style="color:#89DDFF;">:</span><span style="color:#FF9E64;"> true</span><span style="color:#9ABDF5;"> })</span></span>
<span class="line"><span style="color:#7DCFFF;">export</span><span style="color:#BB9AF7;"> class</span><span style="color:#C0CAF5;"> Order</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#51597D;font-style:italic;">  //...</span></span>
<span class="line"><span style="color:#89DDFF;">  @</span><span style="color:#C0CAF5;">Fields</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">string</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C0CAF5;">Order</span><span style="color:#89DDFF;">&gt;</span><span style="color:#9ABDF5;">({</span></span>
<span class="line"><span style="color:#7AA2F7;">    sqlExpression</span><span style="color:#89DDFF;">:</span><span style="color:#9D7CD8;font-style:italic;"> async</span><span style="color:#9ABDF5;"> ()</span><span style="color:#BB9AF7;"> =&gt;</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">      const</span><span style="color:#BB9AF7;"> customer</span><span style="color:#89DDFF;"> =</span><span style="color:#BB9AF7;font-style:italic;"> await</span><span style="color:#7AA2F7;"> dbNamesOf</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Customer</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">      const</span><span style="color:#BB9AF7;"> order</span><span style="color:#89DDFF;"> =</span><span style="color:#BB9AF7;font-style:italic;"> await</span><span style="color:#7AA2F7;"> dbNamesOf</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Order</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#BB9AF7;font-style:italic;">      return</span><span style="color:#89DDFF;"> \`</span><span style="color:#9ECE6A;">(</span></span>
<span class="line"><span style="color:#9ECE6A;">          select </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">customer</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">city</span><span style="color:#7DCFFF;">}</span></span>
<span class="line"><span style="color:#9ECE6A;">            from </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">customer</span><span style="color:#7DCFFF;">}</span></span>
<span class="line"><span style="color:#9ECE6A;">           where </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">customer</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">id</span><span style="color:#7DCFFF;">}</span><span style="color:#9ECE6A;"> = </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">order</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">customer</span><span style="color:#7DCFFF;">}</span></span>
<span class="line"><span style="color:#9ECE6A;">          )</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#9ABDF5;">    }</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">  })</span></span>
<span class="line"><span style="color:#73DACA;">  city</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#9ABDF5;">}</span></span></code></pre></div><ul><li>This adds a calculated <code>city</code> field to the <code>Order</code> entity that we can use to order by or filter</li></ul><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#C0CAF5;">console</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">table</span><span style="color:#9ABDF5;">(</span></span>
<span class="line"><span style="color:#BB9AF7;font-style:italic;">  await</span><span style="color:#7AA2F7;"> repo</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Order</span><span style="color:#9ABDF5;">)</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">find</span><span style="color:#9ABDF5;">({</span></span>
<span class="line"><span style="color:#73DACA;">    where</span><span style="color:#89DDFF;">:</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#73DACA;">      city</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">London</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">    }</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">  })</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">)</span></span></code></pre></div><details class="details custom-block"><summary>Side Note</summary><p>In this option, <code>city</code> is always calculated, and the <code>sqlExpression</code> is always executed. Not a big deal, but it&#39;s woth mentioning. (Check out Option 5 for a solution)</p></details><h2 id="option-5-dedicated-entity" tabindex="-1">Option 5 - Dedicated entity <a class="header-anchor" href="#option-5-dedicated-entity" aria-label="Permalink to &quot;Option 5 - Dedicated entity&quot;">â€‹</a></h2><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#7DCFFF;">export</span><span style="color:#BB9AF7;"> class</span><span style="color:#C0CAF5;"> OrderWithCity</span><span style="color:#9D7CD8;font-style:italic;"> extends</span><span style="color:#BB9AF7;"> Order</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">  @</span><span style="color:#C0CAF5;">Fields</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">string</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C0CAF5;">Order</span><span style="color:#89DDFF;">&gt;</span><span style="color:#9ABDF5;">({</span></span>
<span class="line"><span style="color:#7AA2F7;">    sqlExpression</span><span style="color:#89DDFF;">:</span><span style="color:#9D7CD8;font-style:italic;"> async</span><span style="color:#9ABDF5;"> ()</span><span style="color:#BB9AF7;"> =&gt;</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">      const</span><span style="color:#BB9AF7;"> customer</span><span style="color:#89DDFF;"> =</span><span style="color:#BB9AF7;font-style:italic;"> await</span><span style="color:#7AA2F7;"> dbNamesOf</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Customer</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">      const</span><span style="color:#BB9AF7;"> order</span><span style="color:#89DDFF;"> =</span><span style="color:#BB9AF7;font-style:italic;"> await</span><span style="color:#7AA2F7;"> dbNamesOf</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">Order</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#BB9AF7;font-style:italic;">      return</span><span style="color:#89DDFF;"> \`</span><span style="color:#9ECE6A;">(</span></span>
<span class="line"><span style="color:#9ECE6A;">          select </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">customer</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">city</span><span style="color:#7DCFFF;">}</span></span>
<span class="line"><span style="color:#9ECE6A;">            from </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">customer</span><span style="color:#7DCFFF;">}</span></span>
<span class="line"><span style="color:#9ECE6A;">           where </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">customer</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">id</span><span style="color:#7DCFFF;">}</span><span style="color:#9ECE6A;"> = </span><span style="color:#7DCFFF;">\${</span><span style="color:#C0CAF5;">order</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">customer</span><span style="color:#7DCFFF;">}</span></span>
<span class="line"><span style="color:#9ECE6A;">          )</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#9ABDF5;">    }</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#9ABDF5;">  })</span></span>
<span class="line"><span style="color:#73DACA;">  city</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> &#39;&#39;</span></span>
<span class="line"><span style="color:#9ABDF5;">}</span></span></code></pre></div><p>Like this, in your code, you can use <code>OrderWithCity</code> or <code>Order</code> depending on your needs.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>As <code>OrderWithCity</code> extends <code>Order</code>, everything in <code>Order</code> is also available in <code>OrderWithCity</code> ðŸŽ‰.</p></div>`,28)]))}const A=n(p,[["render",e]]);export{i as __pageData,A as default};
