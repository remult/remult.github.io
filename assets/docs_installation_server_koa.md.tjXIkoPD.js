import{_ as a,c as n,o,L as e}from"./chunks/framework.DdPzwmCl.js";const D=JSON.parse('{"title":"Koa","description":"","frontmatter":{},"headers":[],"relativePath":"docs/installation/server/koa.md","filePath":"docs/installation/server/koa.md","lastUpdated":1729890666000}'),l={name:"docs/installation/server/koa.md"};function p(t,s,r,c,i,y){return o(),n("div",null,s[0]||(s[0]=[e(`<h1 id="koa" tabindex="-1">Koa <a class="header-anchor" href="#koa" aria-label="Permalink to &quot;Koa&quot;">​</a></h1><h3 id="install-required-packages" tabindex="-1">Install Required Packages <a class="header-anchor" href="#install-required-packages" aria-label="Permalink to &quot;Install Required Packages&quot;">​</a></h3><p>To set up your Koa server with Remult, run the following commands to install the necessary packages:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#C0CAF5;">npm</span><span style="color:#9ECE6A;"> install</span><span style="color:#9ECE6A;"> koa</span><span style="color:#9ECE6A;"> koa-bodyparser</span><span style="color:#9ECE6A;"> remult</span></span>
<span class="line"><span style="color:#C0CAF5;">npm</span><span style="color:#9ECE6A;"> install</span><span style="color:#E0AF68;"> --save-dev</span><span style="color:#9ECE6A;"> @types/koa</span><span style="color:#9ECE6A;"> @types/koa-bodyparser</span><span style="color:#9ECE6A;"> tsx</span></span></code></pre></div><h3 id="bootstrap-remult-in-the-backend" tabindex="-1">Bootstrap Remult in the Backend <a class="header-anchor" href="#bootstrap-remult-in-the-backend" aria-label="Permalink to &quot;Bootstrap Remult in the Backend&quot;">​</a></h3><p>Remult is integrated into your backend as middleware for Koa.</p><ol><li><p><strong>Create the API File</strong></p><p>Create a new <code>api.ts</code> file in the <code>src/server/</code> folder with the following code to set up the Remult middleware:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#51597D;font-style:italic;">// src/server/api.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7DCFFF;">import</span><span style="color:#9ABDF5;"> { </span><span style="color:#0DB9D7;">createRemultServer</span><span style="color:#9ABDF5;"> }</span><span style="color:#7DCFFF;"> from</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">remult/server</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7DCFFF;">export</span><span style="color:#9D7CD8;font-style:italic;"> const</span><span style="color:#BB9AF7;"> api</span><span style="color:#89DDFF;"> =</span><span style="color:#7AA2F7;"> createRemultServer</span><span style="color:#9ABDF5;">()</span></span></code></pre></div></li><li><p><strong>Register the Middleware</strong></p><p>Update the <code>index.ts</code> file in your <code>src/server/</code> folder to include the Remult middleware. Add the following lines:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#51597D;font-style:italic;">// src/server/index.ts</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#7DCFFF;">import</span><span style="color:#FF9E64;"> *</span><span style="color:#89DDFF;"> as</span><span style="color:#0DB9D7;"> koa</span><span style="color:#7DCFFF;"> from</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">koa</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#7DCFFF;">import</span><span style="color:#FF9E64;"> *</span><span style="color:#89DDFF;"> as</span><span style="color:#0DB9D7;"> bodyParser</span><span style="color:#7DCFFF;"> from</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">koa-bodyparser</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#7DCFFF;">import</span><span style="color:#9ABDF5;"> { </span><span style="color:#0DB9D7;">api</span><span style="color:#9ABDF5;"> }</span><span style="color:#7DCFFF;"> from</span><span style="color:#89DDFF;"> &#39;</span><span style="color:#9ECE6A;">./api.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">const</span><span style="color:#BB9AF7;"> app</span><span style="color:#89DDFF;"> =</span><span style="color:#89DDFF;"> new</span><span style="color:#7AA2F7;"> koa</span><span style="color:#9ABDF5;">()</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#C0CAF5;">app</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">use</span><span style="color:#9ABDF5;">(</span><span style="color:#7AA2F7;">bodyParser</span><span style="color:#9ABDF5;">())</span><span style="color:#51597D;font-style:italic;"> // Enables JSON body parsing for API requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C0CAF5;">app</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">use</span><span style="color:#9ABDF5;">(</span><span style="color:#9D7CD8;font-style:italic;">async</span><span style="color:#9ABDF5;"> (</span><span style="color:#E0AF68;">ctx</span><span style="color:#89DDFF;">,</span><span style="color:#E0AF68;"> next</span><span style="color:#9ABDF5;">)</span><span style="color:#BB9AF7;"> =&gt;</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#9D7CD8;font-style:italic;">  const</span><span style="color:#BB9AF7;"> r</span><span style="color:#89DDFF;"> =</span><span style="color:#BB9AF7;font-style:italic;"> await</span><span style="color:#C0CAF5;"> api</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">handle</span><span style="color:#9ABDF5;">(</span><span style="color:#C0CAF5;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">request</span><span style="color:#9ABDF5;">) </span><span style="color:#51597D;font-style:italic;">// Handle API requests with Remult</span></span>
<span class="line"><span style="color:#BB9AF7;">  if</span><span style="color:#9ABDF5;"> (</span><span style="color:#C0CAF5;">r</span><span style="color:#9ABDF5;">) {</span></span>
<span class="line"><span style="color:#C0CAF5;">    ctx</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">response</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">body</span><span style="color:#89DDFF;"> =</span><span style="color:#C0CAF5;"> r</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">data</span></span>
<span class="line"><span style="color:#C0CAF5;">    ctx</span><span style="color:#89DDFF;">.</span><span style="color:#C0CAF5;">response</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">status</span><span style="color:#89DDFF;"> =</span><span style="color:#C0CAF5;"> r</span><span style="color:#89DDFF;">.</span><span style="color:#7DCFFF;">statusCode</span></span>
<span class="line"><span style="color:#9ABDF5;">  } </span><span style="color:#BB9AF7;">else</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#BB9AF7;font-style:italic;">    await</span><span style="color:#7AA2F7;"> next</span><span style="color:#9ABDF5;">() </span><span style="color:#51597D;font-style:italic;">// If not handled by Remult, pass on to the next middleware</span></span>
<span class="line"><span style="color:#9ABDF5;">  }</span></span>
<span class="line"><span style="color:#9ABDF5;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C0CAF5;">app</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">listen</span><span style="color:#9ABDF5;">(</span><span style="color:#FF9E64;">3002</span><span style="color:#89DDFF;">,</span><span style="color:#9ABDF5;"> ()</span><span style="color:#BB9AF7;"> =&gt;</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#C0CAF5;">  console</span><span style="color:#89DDFF;">.</span><span style="color:#7AA2F7;">log</span><span style="color:#9ABDF5;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ECE6A;">Server started on port 3002</span><span style="color:#89DDFF;">&#39;</span><span style="color:#9ABDF5;">)</span></span>
<span class="line"><span style="color:#9ABDF5;">})</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">ESM Configuration</p><p>In this tutorial, we are using ECMAScript modules (<code>esm</code>) for the Node.js server. When importing files, you must include the <code>.js</code> suffix (as shown in the <code>import { api } from &quot;./api.js&quot;</code> statement).</p><p>Additionally, make sure to set <code>&quot;type&quot;: &quot;module&quot;</code> in your <code>package.json</code> file.</p></div></li></ol><h4 id="create-the-server-s-typescript-configuration" tabindex="-1">Create the Server&#39;s TypeScript Configuration <a class="header-anchor" href="#create-the-server-s-typescript-configuration" aria-label="Permalink to &quot;Create the Server&#39;s TypeScript Configuration&quot;">​</a></h4><p>In the root folder, create a TypeScript configuration file named <code>tsconfig.server.json</code> to manage the server&#39;s settings:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#9ABDF5;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#7AA2F7;">compilerOptions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#9ABDF5;"> {</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#0DB9D7;">experimentalDecorators</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#FF9E64;"> true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#0DB9D7;">skipLibCheck</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#FF9E64;"> true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#0DB9D7;">esModuleInterop</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#FF9E64;"> true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#0DB9D7;">outDir</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#9ECE6A;">dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#0DB9D7;">rootDir</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#9ECE6A;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    &quot;</span><span style="color:#0DB9D7;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#9ECE6A;">nodenext</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#9ABDF5;">  }</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  &quot;</span><span style="color:#7AA2F7;">include</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#9ABDF5;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">src/server/**/*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#9ECE6A;">src/shared/**/*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ABDF5;">]</span></span>
<span class="line"><span style="color:#9ABDF5;">}</span></span></code></pre></div><p>This configuration enables TypeScript decorators, ensures compatibility with ECMAScript modules, and specifies the file paths for the server and shared code.</p><h4 id="create-an-npm-script-to-start-the-api-server" tabindex="-1">Create an <code>npm</code> Script to Start the API Server <a class="header-anchor" href="#create-an-npm-script-to-start-the-api-server" aria-label="Permalink to &quot;Create an \`npm\` Script to Start the API Server&quot;">​</a></h4><p>To simplify the development process, add a new script in your <code>package.json</code> file to start the Koa server in development mode:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#51597D;font-style:italic;">// package.json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">dev-node</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A9B1D6;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#9ECE6A;">tsx watch --env-file=.env --tsconfig tsconfig.server.json src/server</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><ul><li><code>tsx</code>: A TypeScript Node.js execution environment that watches for file changes and automatically restarts the server on each save.</li><li><code>--env-file=.env</code>: Ensures environment variables are loaded from the <code>.env</code> file.</li><li><code>--tsconfig tsconfig.server.json</code>: Specifies the TypeScript configuration file for the server.</li></ul><h4 id="start-the-koa-server" tabindex="-1">Start the Koa Server <a class="header-anchor" href="#start-the-koa-server" aria-label="Permalink to &quot;Start the Koa Server&quot;">​</a></h4><p>Finally, open a new terminal and run the following command to start the development server:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki tokyo-night vp-code" style="background-color:#1a1b26;color:#a9b1d6;" tabindex="0"><code><span class="line"><span style="color:#C0CAF5;">npm</span><span style="color:#9ECE6A;"> run</span><span style="color:#9ECE6A;"> dev-node</span></span></code></pre></div><p>The server will now run on port 3002. <code>tsx</code> will watch for any file changes, automatically restarting the server whenever updates are made.</p>`,19)]))}const d=a(l,[["render",p]]);export{D as __pageData,d as default};
